# XCOM 2 - Комплексное описание реализованных механик

## Обзор игры XCOM 2

XCOM 2 - это тактическая пошаговая стратегия, где игрок управляет отрядом солдат в борьбе против инопланетного вторжения. Игра известна своей глубокой тактической системой, включающей множество механик, которые создают богатый и сложный игровой опыт.

## Реализованные механики в проекте AliensAttack

### **Первые 5 механик (Базовые)**

#### 1. **Система скрытности (Concealment/Stealth)**
- **Описание:** Механика скрытого передвижения и внезапных атак
- **Особенности:**
  - Скрытое передвижение юнитов
  - Бонусы к атакам из скрытности
  - Автоматическое раскрытие при определенных действиях
  - Система обнаружения врагами
- **Реализация:** `VisibilityType`, методы `conceal()`, `reveal()`, `isDetectedBy()`

#### 2. **Механика фланговых атак (Flanking)**
- **Описание:** Система атак с фланга для обхода укрытий
- **Особенности:**
  - Проверка позиции атакующего относительно укрытия
  - Бонусы к урону и точности при фланговых атаках
  - Система укрытий с различными уровнями защиты
- **Реализация:** `CoverType.FLANKED`, методы `isUnitFlanked()`, `flankingAttack()`

#### 3. **Подавляющий огонь (Suppression Fire)**
- **Описание:** Ограничение действий вражеских юнитов
- **Особенности:**
  - Снижение точности подавленных юнитов
  - Ограничение движения
  - Автоматическое снятие подавления
- **Реализация:** `StatusEffect.SUPPRESSED`, методы `applySuppression()`, `canMoveWhileSuppressed()`

#### 4. **Разрушаемая среда (Destructible Environment)**
- **Описание:** Система разрушения объектов окружения
- **Особенности:**
  - Разрушение укрытий и препятствий
  - Взрывы с уроном по области
  - Изменение тактической ситуации
- **Реализация:** `EnvironmentObject`, методы `takeDamage()`, `handleEnvironmentExplosion()`

#### 5. **Сплоченность отряда (Squad Cohesion)**
- **Описание:** Командные бонусы и тактики
- **Особенности:**
  - Различные типы тактик отряда
  - Бонусы к характеристикам в зависимости от тактики
  - Система кулдаунов для тактик
- **Реализация:** `SquadTactic`, `SquadTacticType`, методы `activateSquadTactic()`

### **Вторые 5 механик (Продвинутые)**

#### 6. **Псионическая боевая система (Psionic Combat)**
- **Описание:** Психические способности и контроль разума
- **Особенности:**
  - 8 типов псионических способностей
  - Система пси-энергии и сопротивления
  - Контроль вражеских юнитов
  - Психические атаки
- **Реализация:** `PsionicAbility`, `PsionicType`, методы `usePsionicAbility()`

#### 7. **Экологические опасности (Environmental Hazards)**
- **Описание:** Опасности окружающей среды
- **Особенности:**
  - 6 типов экологических опасностей
  - Автоматическое применение урона
  - Снижение характеристик юнитов
  - Создание зон опасности
- **Реализация:** Новые `StatusEffect`, методы `applyEnvironmentalHazard()`

#### 8. **Взгляд отряда (Squad Sight)**
- **Описание:** Дальнее наведение через зрение союзников
- **Особенности:**
  - Доступно определенным классам солдат
  - Бонусы к дальности и точности
  - Координация между юнитами
- **Реализация:** Методы `canUseSquadSight()`, `squadSightAttack()`

#### 9. **Взлом и технические способности (Hacking/Technical)**
- **Описание:** Система взлома и технических способностей
- **Особенности:**
  - Взлом вражеских роботов
  - Технические способности с уникальными эффектами
  - Система успешности взлома
- **Реализация:** Новые классы солдат, методы `useHackingAbility()`

#### 10. **Разрыв скрытности (Concealment Breaks)**
- **Описание:** Автоматические механизмы раскрытия
- **Особенности:**
  - Автоматическое раскрытие при получении урона
  - Раскрытие при использовании оружия
  - Проверка возможности сохранения скрытности
- **Реализация:** Методы `shouldBreakConcealment()`, `forceBreakConcealment()`

### **Третьи 5 механик (Итерация 1)**

#### 11. **Координированные атаки в режиме ожидания (Overwatch Ambush)**
- **Описание:** Синхронизированные атаки нескольких юнитов
- **Особенности:**
  - Координация нескольких юнитов
  - Бонусы к точности (+15%) и урону (+5)
  - Автоматическое срабатывание при обнаружении врага
- **Реализация:** `OverwatchType.AMBUSH`, методы `setupOverwatchAmbush()`

#### 12. **Преимущество высоты (Height Advantage)**
- **Описание:** Бонусы за позицию на возвышенности
- **Особенности:**
  - Бонус к точности (+10% за уровень высоты)
  - Бонус к урону (+1 за каждые 10% бонуса высоты)
  - Естественная защита на возвышенности
- **Реализация:** Поле `height` в `Position`, методы `getHeightAdvantageBonus()`

#### 13. **Гранатомет (Grenade Launcher)**
- **Описание:** Специализированное оружие для запуска гранат
- **Особенности:**
  - Увеличенная дальность (+8)
  - Радиус поражения 3 клетки
  - Площадной урон
- **Реализация:** `WeaponType.GRENADE_LAUNCHER`, методы `grenadeLauncherAttack()`

#### 14. **Система медикаментов (Medikit System)**
- **Описание:** Лечение и медицинские способности
- **Особенности:**
  - Лечение живых юнитов
  - Возможность воскрешения мертвых юнитов
  - Лечение статус-эффектов
  - Ограниченное количество использований
- **Реализация:** Класс `Medikit`, методы `useMedikit()`, `cureStatusEffects()`

#### 15. **Типы боеприпасов (Ammo Types)**
- **Описание:** Различные типы боеприпасов со специальными эффектами
- **Особенности:**
  - 9 типов боеприпасов
  - Специальные эффекты (огонь, кислота, яд)
  - Бонусы к урону и точности
  - Статус-эффекты от боеприпасов
- **Реализация:** `AmmoType`, методы `ammoTypeAttack()`, `getAmmoTypeEffectiveness()`

## Архитектурные принципы реализации

### **Объектно-ориентированный подход**
- **Наследование:** Иерархия менеджеров боя (`XCOM2CombatManager` → `AdvancedXCOM2CombatManager` → `UltimateXCOM2CombatManager`)
- **Композиция:** Механики как отдельные компоненты (оружие, способности, статус-эффекты)
- **Инкапсуляция:** Приватные методы для внутренней логики
- **Полиморфизм:** Различные типы способностей и оружия

### **Чистый код**
- **Единая ответственность:** Каждый класс отвечает за одну механику
- **Открытость/закрытость:** Легко добавлять новые механики без изменения существующих
- **Принцип подстановки Лисков:** Все менеджеры боя взаимозаменяемы
- **Инверсия зависимостей:** Зависимость от абстракций, а не от конкретных классов

### **Расширяемость**
- **Фабричный паттерн:** Создание различных типов способностей и оружия
- **Стратегия:** Различные типы атак и способностей
- **Наблюдатель:** Система событий для статус-эффектов
- **Команда:** Инкапсуляция запросов как объектов

## Техническая реализация

### **Структура проекта**
```
src/main/java/com/aliensattack/
├── core/
│   ├── enums/          # Перечисления типов
│   ├── model/          # Модели данных
│   └── interfaces/     # Интерфейсы
├── combat/             # Менеджеры боя
├── field/              # Тактическое поле
└── utils/              # Утилиты
```

### **Ключевые классы**
- **`Unit`** - Основная модель юнита с поддержкой всех механик
- **`Weapon`** - Система оружия с типами боеприпасов
- **`Position`** - Позиция с поддержкой высоты
- **`CombatResult`** - Результаты боевых действий
- **`StatusEffectData`** - Данные статус-эффектов

### **Интеграция с Spring Boot**
- **Конфигурация:** Разделение `application.properties` по типам
- **Dependency Injection:** Использование Spring для управления зависимостями
- **Профили:** Различные конфигурации для разработки и продакшена

## Производительность и оптимизация

### **Алгоритмическая сложность**
- **O(1)** для большинства операций с юнитами
- **O(n)** для поиска юнитов в области
- **O(log n)** для поиска по позициям
- **O(1)** для проверок статус-эффектов

### **Память**
- **Эффективное использование:** Переиспользование объектов
- **Кэширование:** Кэш результатов вычислений
- **Ленивая загрузка:** Загрузка данных по требованию

### **Масштабируемость**
- **Горизонтальное масштабирование:** Поддержка множественных боевых полей
- **Вертикальное масштабирование:** Оптимизация для больших отрядов
- **Модульность:** Независимые компоненты механик

## Заключение

Реализованная система представляет собой наиболее полную реализацию тактических механик XCOM 2 в Java, включающую:

### **15 ключевых механик:**
1. Скрытность и стелс
2. Фланговые атаки
3. Подавляющий огонь
4. Разрушаемая среда
5. Сплоченность отряда
6. Псионические способности
7. Экологические опасности
8. Взгляд отряда
9. Взлом и технические способности
10. Разрыв скрытности
11. Координированные атаки
12. Преимущество высоты
13. Гранатометы
14. Система медикаментов
15. Типы боеприпасов

### **Технические достижения:**
- Полная интеграция с существующей архитектурой
- Соблюдение принципов SOLID
- Высокая производительность
- Легкая расширяемость
- Поддержка всех основных тактических элементов XCOM 2

Проект демонстрирует глубокое понимание тактических механик XCOM 2 и их эффективную реализацию в Java с использованием современных принципов разработки программного обеспечения. 